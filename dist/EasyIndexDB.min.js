!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).EasyIndexDB=t()}(this,function(){"use strict";var t=(e.prototype.parserSQL=function(e){for(var t=e.toString().trim().toLowerCase(),n=this.handleSingleQuoSpace(t),r=0,s=n.length;r<s;r+=1){var o=n[r],a=0,i=o.length;if(o){for(;a<i;a+=1){var u=o.charAt(a);if(/^[a-z_]+$/i.test(u)||/^[0-9_]+$/i.test(u)){for(var c="",l=o.charAt(a);a<o.length;){if(a++,c=o.charAt(a),!/^[\w\.:]+$/i.test(c)){a--;break}l+=c}console.log(l),this.tokenQue.push(l)}}this.handleAllEnd()}}},e.prototype.getLexterResult=function(){var e=this.sqlQue;return this.sqlQue=[],this.tokenQue=[],e},e.prototype.tokenStart=function(e){},e.prototype.tokenEnd=function(e){},e.prototype.handleAllEnd=function(){var e={cmd:this.tokenQue.shift(),other:this.tokenQue};this.tokenQue=[],this.sqlQue.push(e)},e.prototype.handleSingleQuoSpace=function(e){var t=e.split(";");return 0<=t.length?t.map(function(e){return e.trim()}):t},e);function e(){this.sqlQue=[],this.tokenQue=[]}var s,n,o=(r.parserUseSql=function(e,t){var n={dbName:e.other.shift(),version:t};return{cmd:e.cmd,use:n}},r);function r(){}(n=s=s||{}).Use="use",n.Create="create",n.Select="select",n.Update="update",n.Insert="insert",n.Delete="delete";var a=(i.parserTableSql=function(e){e.other.shift();var t=e.cmd,n=e.other.shift(),r=new Map;return e.other.forEach(function(e,t,n){r.set(e,e)}),{cmd:t,table:{tableName:n,column:r}}},i);function i(){}function c(e,t){if(Array.isArray(t))for(var n=0,r=t.length;n<r;n+=1)if(e===t[n])return 1;return s=t,!("[object DOMStringList]"!==toString.call(s)||!t.contains(e));var s}var u=(l.prototype.executeUse=function(e){var t=e.use.version,n=e.use.dbName;this.dbMessage.dbName=n,this.request=indexedDB.open(n,t),this.request.onerror=this.requestError.bind(this),this.request.onsuccess=this.requestSuccess.bind(this),this.request.onupgradeneeded=this.onupgradeneeded.bind(this)},l.prototype.executeTable=function(e){e.table.tableName,e.table.column,this.managerObj.push(e)},l.prototype.executeInsert=function(e){var r,t=e.insert.tableName,n=e.insert.column,s=this.db.transaction([t],"readwrite").objectStore(t),o=(r={},n.forEach(function(e,t,n){r[t]=e}),r);console.log("executeInsert:",o),s.add(o)},l.prototype.requestError=function(){console.log("requestError")},l.prototype.requestSuccess=function(e){this.db=e.target.result,console.log("requestSuccess:",e)},l.prototype.onupgradeneeded=function(e){var a=this;console.log("requestUpgradeneeded, event:",e);var t=e.oldVersion,n=e.oldVersion,i=e.target.result,u=i.objectStoreNames;this.dbMessage.oldVersion=t,this.dbMessage.newVersion=n,this.dbMessage.objectStoreNames=u,console.log("dbMessage:",this.dbMessage),this.managerObj.forEach(function(e,t,n){var r=e.table,s=r.tableName,o=r.column;c(s,u)?console.log("has table:",s):(a.createTable(i,s,o),console.log("do not has talbe:",s))})},l.prototype.updateTable=function(){},l.prototype.createTable=function(e,t,n){var r=e.createObjectStore(t,{keyPath:"id",autoIncrement:!0});n.forEach(function(e,t){r.createIndex(e,e,{unique:!1})})},l);function l(){this.version=0,this.dbName="",this.managerObj=[],this.dbMessage={dbName:"",oldVersion:0,newVersion:0,objectStoreNames:[]}}var h=(d.parseInsertSql=function(e,t){var n=e.cmd,r=e.other,s=[],o=[],a=t,i=new Map,u=!1;r.shift();var c=r.shift();return r.forEach(function(e,t,n){"values"!==e?u?"slot"===e?o.push(a.shift()):o.push(e):s.push(e):u=!0}),s.forEach(function(e,t,n){i.set(e,o[t])}),{cmd:n,insert:{tableName:c,column:i}}},d);function d(){}var f=(p.prototype.execute=function(e){var t,r=this,n="";t=e,"[object Array]"===toString.call(t)?(n=e.shift(),e.forEach(function(e,t,n){r.slotQue.push(e)})):n=e,this.sqlLexter.parserSQL(n);var s=this.sqlLexter.getLexterResult();console.log("afterSqlLexter:",s),s.forEach(this.handleLexter.bind(this))},p.prototype.handleLexter=function(e,t,n){var r=null;switch(e.cmd){case s.Use:r=o.parserUseSql(e,this.version),this.dbManager.executeUse(r);break;case s.Create:r=a.parserTableSql(e),this.dbManager.executeTable(r);break;case s.Insert:r=h.parseInsertSql(e,this.slotQue),this.dbManager.executeInsert(r);break;case s.Delete:case s.Select:case s.Update:break;default:console.error("sqlKey is not defined")}console.log("handleLexter: ",r)},p);function p(e){this.sqlLexter=null,this.dbManager=null,this.slotQue=[],this.version=0,this.version=e,this.sqlLexter=new t,this.dbManager=new u}var b=new f(18);return b.execute("\n  use DBName_1;\n\n  create table TName_1\n  (\n    name,\n    age,\n    relation,\n  );\n  create table TName_2\n  (\n    name2,\n    age2,\n    relation2,\n  );\n"),setTimeout(function(){b.execute('insert into TName_1(name, age, relation) values("xxq", "25", "child")')},5e3),f});
