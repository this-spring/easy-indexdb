!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).EasyIndexDB=t()}(this,function(){"use strict";var t=(e.prototype.parserSQL=function(e){for(var t=e.toString().trim().toLowerCase(),n=this.handleSingleQuoSpace(t),r=0,o=n.length;r<o;r+=1){var s=n[r],a=0,i=s.length;if(s){for(;a<i;a+=1){var u=s.charAt(a);if(/^[a-z_]+$/i.test(u)){for(var l="",c=s.charAt(a);a<s.length;){if(a++,l=s.charAt(a),!/^[\w\.:]+$/i.test(l)){a--;break}c+=l}console.log(c),this.tokenQue.push(c)}}this.handleAllEnd()}}},e.prototype.getLexterResult=function(){return this.sqlQue},e.prototype.tokenStart=function(e){},e.prototype.tokenEnd=function(e){},e.prototype.handleAllEnd=function(){var e={cmd:this.tokenQue.shift(),other:this.tokenQue};this.tokenQue=[],this.sqlQue.push(e)},e.prototype.handleSingleQuoSpace=function(e){var t=e.split(";");return 0<=t.length?t.map(function(e){return e.trim()}):t},e);function e(){this.sqlQue=[],this.tokenQue=[]}var o,n,s=(r.parserUseSql=function(e,t){var n={dbName:e.other.shift(),version:t};return{cmd:e.cmd,use:n}},r);function r(){}(n=o=o||{}).Use="use",n.Create="create",n.Select="select",n.Update="update",n.Insert="insert",n.Delete="delete";var a=(i.parserTableSql=function(e){e.other.shift();var t=e.cmd,n=e.other.shift(),r=new Map;return e.other.forEach(function(e,t,n){r.set(e,e)}),{cmd:t,table:{tableName:n,column:r}}},i);function i(){}function l(e,t){if(Array.isArray(t))for(var n=0,r=t.length;n<r;n+=1)if(e===t[n])return 1;return o=t,!(!toString.call(o)||!t.contains(e));var o}var u=(c.prototype.executeUse=function(e){var t=e.use.version,n=e.use.dbName;this.dbMessage.dbName=n,this.request=indexedDB.open(n,t),this.request.onerror=this.requestError.bind(this),this.request.onsuccess=this.requestSuccess.bind(this),this.request.onupgradeneeded=this.onupgradeneeded.bind(this)},c.prototype.executeTable=function(e){e.table.tableName,e.table.column,this.managerObj.push(e)},c.prototype.requestError=function(){console.log("requestError")},c.prototype.requestSuccess=function(){console.log("requestSuccess")},c.prototype.onupgradeneeded=function(e){var a=this;console.log("requestUpgradeneeded, event:",e);var t=e.oldVersion,n=e.oldVersion,i=e.target.result,u=i.objectStoreNames;this.dbMessage.oldVersion=t,this.dbMessage.newVersion=n,this.dbMessage.objectStoreNames=u,console.log("dbMessage:",this.dbMessage),this.managerObj.forEach(function(e,t,n){var r=e.table,o=r.tableName,s=r.column;l(o,u)?console.log("has table:",o):(a.createTable(i,o,s),console.log("do not has talbe:",o))})},c.prototype.updateTable=function(){},c.prototype.createTable=function(e,t,n){var r=e.createObjectStore(t,{keyPath:"id",autoIncrement:!0});n.forEach(function(e,t){r.createIndex(e,e,{unique:!1})})},c);function c(){this.version=0,this.dbName="",this.managerObj=[],this.dbMessage={dbName:"",oldVersion:0,newVersion:0,objectStoreNames:[]}}var h=(d.prototype.execute=function(e){this.sqlLexter.parserSQL(e),this.sqlLexter.getLexterResult().forEach(this.handleLexter.bind(this))},d.prototype.handleLexter=function(e,t,n){var r=null;switch(e.cmd){case o.Use:r=s.parserUseSql(e,this.version),this.dbManager.executeUse(r);break;case o.Create:r=a.parserTableSql(e),this.dbManager.executeTable(r);break;default:console.error("sqlKey is not defined")}console.log("handleLexter: ",r)},d);function d(e){this.sqlLexter=null,this.dbManager=null,this.version=0,this.version=e,this.sqlLexter=new t,this.dbManager=new u}return new h(16).execute("\n  use DBName_1;\n\n  create table TName_1\n  (\n    name,\n    age,\n    relation,\n  );\n  create table TName_2\n  (\n    name2,\n    age2,\n    relation2,\n  );\n"),h});
